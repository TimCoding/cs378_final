#!/usr/bin/env python

import os
import sys
import subprocess as sub
import fileinput
from shutil import copyfile
import Constants

target_ip = sys.argv[1]
p = sub.Popen(["nmap", "-sV", "--script=vulscan/vulscan.nse", "--script-args", "vulscanoutput=listlink", target_ip],stdout=sub.PIPE,stderr=sub.PIPE)
output, errors = p.communicate()
text = output.decode()
text = text.replace("\"", "\'")

with fileinput.FileInput("VulApp.kv", inplace=True, backup='.bak') as file:
    for line in file:
        print(line.replace("PLACEHOLDER", repr(text)), end='')

g = sub.Popen([Constants.KIVY_COMMAND, "VulApp.py"],stdout=sub.PIPE,stderr=sub.PIPE)
g.wait()

os.remove("VulApp.kv")
os.rename("VulApp.kv.bak", "VulApp.kv")
